\documentclass[10pt, letterpaper, twoside]{article}
\usepackage[utf8]{inputenc}
\usepackage{luacode}
\usepackage[a4paper, total={7in, 8in}]{geometry}
\usepackage{pgfplots}
\usepackage{tabularx}
\directlua{dofile("printer.lua")}

\begin{luacode}
  require("lualibs.lua")
  local f = io.open('dataCandidat.json', 'r')
  local s = f:read('*a')
  f:close()
  data =  utilities.json.tolua(s)
\end{luacode}

% Simple print function
\newcommand{\printlua}[1]{\luaexec{tex.sprint(#1)}}

% Example: formatting a number with an optional formatting argument
\newcommand{\printnumber}[2][i]{\printlua{string.format("\%#1", #2)}}

%Example: create a chart with a result
\newcommand{\printChartResult}[2]{
\begin{tikzpicture}
\begin{axis}[%
    xmin=0,
    xmax=10,
    ymin=-0.5,
    ymax=0.5,
    width=13cm,
    height=2cm,
    ticks=none,
    ]
\addplot+[xbar, fill=gray, draw=gray, mark=none, bar width=20] coordinates { (#2,0) };
\addplot+[xbar, draw=blue, fill=blue, mark=none, bar width=5] coordinates { (#1,0) };
 
\end{axis}
\end{tikzpicture}
}

\begin{document}

\begin{center}
    \textbf{\printlua{data['titre']}} \\
    \textbf{\printlua{data['titreAbreviation']}}
\end{center}

\noindent\fbox{
\begin{minipage}{\linewidth}
\begin{tabular}{m{1.2in} m{2.1in} m{1.2in} m{2.1in}}
\underline{Nom:} & \printlua{data['nom']} & \underline{Pr√©nom:} & \printlua{data['prenom']} \\
\underline{Nom de jeune Fille:} & \printlua{data['nomJeuneFille']} & \underline{Sexe:} & \printlua{data['sexe']} \\
\underline{Date de naissance:} & \printlua{data['dateNaissance']} & \underline{Niveau scolaire:} & \printlua{data['niveauScolaire']} \\
\underline{N\textdegree \space d'identification:} & \printlua{data['nIdentification']} & \underline{Type du concours:} & \printlua{data['typeConcours']} \\
\underline{SGAP ou CS:} & \printlua{data['sgap']} & \underline{Version Batterie:} & \printlua{data['versionBatterie']} \\
\underline{Date d'examen:} & \printlua{data['dateExamen']} & \underline{Note Globale:} & \printlua{data['noteGlobale']} \\

\end{tabular}
\end{minipage}
}

\begin{center}
    \textbf{PROFIL DU CANDIDAT} \\
\end{center}

\noindent\fbox{
\begin{minipage}{\linewidth}
\begin{tabular}{m{1in} m{1in} m{1in} m{1in} m{1in} m{1in}}
    \directlua{
        for i=1, data['nombreSubtests'],1 do
            sub = data["subtests"][i]
            tex.print(sub, " = ", data[sub]["notation"] ,"&")
        end
      }

\end{tabular}
\end{minipage}
}

\vspace{1em}

\noindent\fbox{
\begin{minipage}{\linewidth}
\begin{tabular}{m{1.8in} m{0.2in} m{4in}}

\underline{NOTES COMPOSITES} & & 
\begin{tabular}{m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in} m{0.28in}}
\hfill I & \hfill II & \hfill III & \hfill IV & \hfill V & \hfill VI & \hfill VII & \hfill VIII & \hfill IX & \hfill X
\end{tabular}
\\
\directlua{tableComposite()}
\end{tabular}
\end{minipage}
}

\vspace{1em}

\begin{luacode}
    for i=1, data['nombreSimple'],1 do
        simple = data['simple'][i]
        createBox()
        createMinipage()
        createTable()
        tex.print("\\underline{", simple, "}")
        createScale()

        for i=1, data[simple]['nombreNotes'],1 do
            nom = data[simple]["notes"][i]
            tableSimple(i, simple, nom)
        end
        
        endTable()
        endMinipage()
        endBox()
    end
\end{luacode}


\end{document}